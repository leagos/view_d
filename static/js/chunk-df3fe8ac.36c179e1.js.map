{"version":3,"sources":["webpack:///./src/views/list/income.vue?a5d5","webpack:///./node_modules/core-js/modules/es.string.repeat.js","webpack:///./src/views/list/income.vue","webpack:///./src/views/list/income.vue?34b3"],"names":["$","repeat","target","proto","class","left-arrow","title","$t","$goBack","records","item","investor","windIncome","income","setup","store","data","address","state","accounts","web3","provider","BsnContract","BusdContract","windTokenContract","BsnDataContract","initContract","eth","Contract","BSNAbi","config","BsnAddress","BusdAddress","BSNDataAbi","BsnDataAddress","windToken","initData","getList","methods","getAllrecord","call","recordIds","getBlockNumber","block","decimals","windeciams","forEach","getOrderById","order","getBlockPrice","openBlock","price","getWin","result","isOpen","canOpen","Number","back","investAmount","Math","pow","toFixed","slice","winTokenAmount","isWin","substr","length","id","openPrice","unshift","val","refData","__exports__","render"],"mappings":"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","file":"static/js/chunk-df3fe8ac.36c179e1.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--0-1!./income.vue?vue&type=style&index=0&id=20dd8050&lang=less&scoped=true\"","var $ = require('../internals/export');\nvar repeat = require('../internals/string-repeat');\n\n// `String.prototype.repeat` method\n// https://tc39.es/ecma262/#sec-string.prototype.repeat\n$({ target: 'String', proto: true }, {\n  repeat: repeat\n});\n","<template>\r\n  <div class=\"container\">\r\n    <van-nav-bar\r\n      left-arrow\r\n      :title=\"$t('income.用户盈利信息')\"\r\n      @click-left=\"$goBack\" />\r\n    <div class=\"list\">\r\n      <div class=\"item\" v-for=\"item in records\">\r\n        <div class=\"flex\">\r\n          <div class=\"flex-item\">{{$t('income.恭喜')}}{{item.investor}}</div>\r\n        </div>\r\n        <div>\r\n         {{$t('income.获得')}}<span class=\"c-FBC509\">{{item.windIncome}}BNX token</span>{{$t('income.和')}}<span class=\"c-FBC509\">{{item.income}}BUSD</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { reactive, toRefs, computed, watch} from \"vue\";\r\nimport BSNAbi from \"@/utils/BSNAbi\";\r\nimport tokenAbi from \"@/utils/abi\";\r\nimport BSNDataAbi from \"@/utils/BSNDataAbi\";\r\nimport config from \"@/utils/config\";\r\nimport {useStore} from \"vuex\";\r\nexport default {\r\n  setup () {\r\n    const store = useStore()\r\n    const data = reactive({\r\n      records: [],\r\n      address: computed(() => store.state.accounts[0]),\r\n      web3: computed(() => store.state.provider),\r\n      BsnContract: null,\r\n      BusdContract: null,\r\n      windTokenContract: null,\r\n      BsnDataContract: null,\r\n      initContract: () => {\r\n        data.BsnContract = new data.web3.eth.Contract(BSNAbi, config.BsnAddress)\r\n        data.BusdContract = new data.web3.eth.Contract(tokenAbi, config.BusdAddress)\r\n        data.BsnDataContract = new data.web3.eth.Contract(BSNDataAbi, config.BsnDataAddress)\r\n        data.windTokenContract = new data.web3.eth.Contract(tokenAbi, config.windToken)\r\n        data.initData()\r\n      },\r\n      initData: () => {\r\n        data.getList()\r\n      },\r\n      getList: async () => {\r\n        let recordIds = await data.BsnDataContract.methods.getAllrecord().call();\r\n        let block = await data.web3.eth.getBlockNumber()\r\n        let decimals = await data.BusdContract.methods.decimals().call();\r\n        let windeciams = await data.windTokenContract.methods.decimals().call();\r\n        recordIds.forEach(async (item) => {\r\n          let order = await data.BsnDataContract.methods.getOrderById(item).call();\r\n          let price = await data.BsnContract.methods.getBlockPrice(order.openBlock).call()\r\n          let result = await data.BsnContract.methods.getWin(item).call()\r\n          if (price > 0 &&  block >= order.openBlock && !order.isOpen) {\r\n            order.canOpen = true;\r\n          }\r\n          if (price > 0 &&  block >= order.openBlock) {\r\n            if (Number(result.back) > 0) {\r\n              order.income = Number((result.back-order.investAmount)/Math.pow(10, decimals)).toFixed(5).slice(0,-1)\r\n              order.windIncome = Number(result.winTokenAmount/Math.pow(10, windeciams)).toFixed(5).slice(0,-1)\r\n              order.isWin = true;\r\n            } else {\r\n              order.income = Number(result.back/Math.pow(10, windeciams)).toFixed(5).slice(0,-1)\r\n              order.windIncome = Number(result.winTokenAmount/Math.pow(10, windeciams)).toFixed(5).slice(0,-1)\r\n              order.isWin = false;\r\n            }\r\n          }\r\n          if (price <=0) {\r\n            order.canOpen = false;\r\n          }\r\n          order.investor = order.investor.substr(0,4) + '*'.repeat(4) + order.investor.substr(order.investor.length-4,order.investor.length-1);\r\n          order.id = item;\r\n          order.openPrice = price;\r\n          order.investAmount =Number(order.investAmount / Math.pow(10, decimals)).toFixed(5).slice(0,-1)\r\n          if (order.isWin && Number(order.income)) {\r\n            console.log(order)\r\n            data.records.unshift(order) \r\n          }\r\n        })\r\n      }\r\n    })\r\n    if (data.address) {\r\n      data.initContract()\r\n    }\r\n     watch(() => data.address, (val) => {\r\n      if (val) {\r\n        data.initContract()\r\n      }\r\n    })\r\n    const refData = toRefs(data);\r\n    return {\r\n      ...refData\r\n    };\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.list {\r\n  background: rgba(26, 28, 37, 0.7);\r\n  border-radius: 50px;\r\n  margin: 15px;\r\n  color: #fff;\r\n  font-size: 14px;\r\n  padding: 0 15px;\r\n  .item {\r\n    padding: 12px 0;\r\n    &:not(:last-child){\r\n      border-bottom: 1px solid rgba(233, 234, 235, .1);\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import { render } from \"./income.vue?vue&type=template&id=20dd8050&scoped=true\"\nimport script from \"./income.vue?vue&type=script&lang=js\"\nexport * from \"./income.vue?vue&type=script&lang=js\"\n\nimport \"./income.vue?vue&type=style&index=0&id=20dd8050&lang=less&scoped=true\"\n\nimport exportComponent from \"D:\\\\contract\\\\frontend\\\\node_modules\\\\@vue\\\\cli-service\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-20dd8050\"]])\n\nexport default __exports__"],"sourceRoot":""}